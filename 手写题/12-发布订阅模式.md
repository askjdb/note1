# ä»é›¶å¸¦ä½ æ‰‹å†™ä¸€ä¸ªâ€œå‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼â€œ ï¼Œä¿å§†çº§æ•™å­¦

# å‰è¨€

å‘å¸ƒ-è®¢é˜…æ¨¡å¼å…¶å®æ˜¯ä¸€ç§å¯¹è±¡é—´ä¸€å¯¹å¤šçš„ä¾èµ–å…³ç³»ï¼Œå½“ä¸€ä¸ªå¯¹è±¡çš„çŠ¶æ€å‘é€æ”¹å˜æ—¶ï¼Œæ‰€æœ‰ä¾èµ–äºå®ƒçš„å¯¹è±¡éƒ½å°†å¾—åˆ°çŠ¶æ€æ”¹å˜çš„é€šçŸ¥ã€‚

- **è®¢é˜…è€…**ï¼ˆSubscriberï¼‰æŠŠè‡ªå·±æƒ³è®¢é˜…çš„äº‹ä»¶ **æ³¨å†Œ**ï¼ˆSubscribeï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼ˆEvent Channelï¼‰;
- å½“**å‘å¸ƒè€…**ï¼ˆPublisherï¼‰**å‘å¸ƒè¯¥äº‹ä»¶**ï¼ˆPublish Eventï¼‰åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œä¹Ÿå°±æ˜¯è¯¥äº‹ä»¶è§¦å‘æ—¶ï¼Œç”± **è°ƒåº¦ä¸­å¿ƒ** ç»Ÿä¸€è°ƒåº¦ï¼ˆFire Eventï¼‰è®¢é˜…è€…æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒçš„å¤„ç†ä»£ç ã€‚

**â—¾ ä¾‹å­**

æ¯”å¦‚æˆ‘ä»¬å¾ˆå–œæ¬¢çœ‹æŸä¸ªå…¬ä¼—å·çš„æ–‡ç« ï¼Œä½†æ˜¯ä¸çŸ¥é“ä»€ä¹ˆæ—¶å€™å‘å¸ƒæ–°æ–‡ç« ï¼Œè¦ä¸å®šæ—¶çš„å»ç¿»é˜…ï¼›è¿™æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥å…³æ³¨è¯¥å…¬ä¼—å·ï¼Œå½“æœ‰æ–‡ç« æ¨é€æ—¶ï¼Œä¼šæœ‰æ¶ˆæ¯åŠæ—¶é€šçŸ¥æˆ‘ä»¬æ–‡ç« æ›´æ–°äº†ã€‚

ä¸Šé¢ä¸€ä¸ªçœ‹ä¼¼ç®€å•çš„æ“ä½œï¼Œå…¶å®æ˜¯ä¸€ä¸ªå…¸å‹çš„å‘å¸ƒè®¢é˜…æ¨¡å¼ï¼Œå…¬ä¼—å·å±äºå‘å¸ƒè€…ï¼Œç”¨æˆ·å±äºè®¢é˜…è€…ï¼›ç”¨æˆ·å°†è®¢é˜…å…¬ä¼—å·çš„äº‹ä»¶æ³¨å†Œåˆ°è°ƒåº¦ä¸­å¿ƒï¼Œå…¬ä¼—å·ä½œä¸ºå‘å¸ƒè€…ï¼Œå½“æœ‰æ–°æ–‡ç« å‘å¸ƒæ—¶ï¼Œå…¬ä¼—å·å‘å¸ƒè¯¥äº‹ä»¶åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œè°ƒåº¦ä¸­å¿ƒä¼šåŠæ—¶å‘æ¶ˆæ¯å‘ŠçŸ¥ç”¨æˆ·ã€‚

â—¾ å‘å¸ƒ/è®¢é˜…æ¨¡å¼çš„ä¼˜ç‚¹æ˜¯å¯¹è±¡ä¹‹é—´è§£è€¦ï¼Œå¼‚æ­¥ç¼–ç¨‹ä¸­ï¼Œå¯ä»¥æ›´æ¾è€¦åˆçš„ä»£ç ç¼–å†™ï¼›ç¼ºç‚¹æ˜¯åˆ›å»ºè®¢é˜…è€…æœ¬èº«è¦æ¶ˆè€—ä¸€å®šçš„æ—¶é—´å’Œå†…å­˜ï¼Œè™½ç„¶å¯ä»¥å¼±åŒ–å¯¹è±¡ä¹‹é—´çš„è”ç³»ï¼Œå¤šä¸ªå‘å¸ƒè€…å’Œè®¢é˜…è€…åµŒå¥—ä¸€èµ·çš„æ—¶å€™ï¼Œç¨‹åºéš¾ä»¥è·Ÿè¸ªç»´æŠ¤ã€‚

# æ‰‹å†™å®ç°å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼

æ•´ä½“çš„å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼å®ç°æ€è·¯å¦‚ä¸‹ï¼š

- åˆ›å»ºä¸€ä¸ªç±» class
- åœ¨è¿™ä¸ªç±»é‡Œåˆ›å»ºä¸€ä¸ªç¼“å­˜åˆ—è¡¨(*è°ƒåº¦ä¸­å¿ƒ*)
- `on` æ–¹æ³• - ç”¨æ¥æŠŠå‡½æ•°`fn`æ·»åŠ åˆ°ç¼“å­˜åˆ—è¡¨(*è®¢é˜…è€…æ³¨å†Œäº‹ä»¶åˆ°è°ƒåº¦ä¸­å¿ƒ*)
- `emit` æ–¹æ³• - å–åˆ°`event`äº‹ä»¶ç±»å‹ï¼Œæ ¹æ®`event`å€¼å»æ‰§è¡Œå¯¹åº”ç¼“å­˜åˆ—è¡¨ä¸­çš„å‡½æ•°(*å‘å¸ƒè€…å‘å¸ƒäº‹ä»¶åˆ°è°ƒåº¦ä¸­å¿ƒï¼Œè°ƒåº¦ä¸­å¿ƒå¤„ç†ä»£ç *)
- `off` æ–¹æ³• - å¯ä»¥æ ¹æ®`event`äº‹ä»¶ç±»å‹å–æ¶ˆè®¢é˜…(*å–æ¶ˆè®¢é˜…*)

æ¥ä¸‹æ¥æˆ‘ä»¬æ ¹æ®ä¸Šé¢çš„æ€è·¯ï¼Œ**å¼€å§‹æ‰‹å†™å‘å¸ƒ-è®¢é˜…è€…æ¨¡å¼** ğŸ‘‡

## 1. åˆ›å»ºä¸€ä¸ª Observer ç±»

æˆ‘ä»¬å…ˆåˆ›å»ºä¸€ä¸ª Ovserver ç±»ï¼š

```javascript
+ class Observer {
+     
+ }
å¤åˆ¶ä»£ç 
```

åœ¨ Observer ç±»é‡Œï¼Œéœ€è¦æ·»åŠ ä¸€ä¸ªæ„é€ å‡½æ•°ï¼š

```javascript
class Observer {
+   constructor(){
+       
+   }
}
å¤åˆ¶ä»£ç 
```

## 2. æ·»åŠ ä¸‰ä¸ªæ ¸å¿ƒæ–¹æ³•

è¿˜éœ€è¦æ·»åŠ ä¸‰ä¸ªæ–¹æ³•ï¼Œä¹Ÿå°±æ˜¯æˆ‘ä»¬å‰é¢è®²åˆ°çš„`on`ã€`emit`å’Œ`off`æ–¹æ³•ï¼Œä¸ºäº†è®©è¿™ä¸ªæ–¹æ³•é•¿å¾—æ›´åƒ Vueï¼Œæˆ‘ä»¬åœ¨è¿™å‡ ä¸ªæ–¹æ³•å‰é¢éƒ½åŠ ä¸Š`$`ï¼Œå³ï¼š

- å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
- åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
- è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`

```javascript
class Observer {
    constructor() {

    }
+   // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
+   $on(){}
+   // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
+   $off(){}
+   // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
+   $emit(){}
}
å¤åˆ¶ä»£ç 
```

æ–¹æ³•å…·ä½“çš„å†…å®¹æˆ‘ä»¬æ”¾ä¸€æ”¾ï¼Œå…ˆæ¥åˆ›å»ºä¸€ä¸ªè®¢é˜…è€…(å‘å¸ƒè€…)ï¼Œ

ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹ï¼š

```javascript
class Observer {
    constructor() {

    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on(){}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off(){}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit(){}
}

+ // ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
+ const person1 = new Observer()
å¤åˆ¶ä»£ç 
```

æ¥ç€ï¼Œæˆ‘ä»¬å‘è¿™ä¸ª`person1`å§”æ‰˜ä¸€äº›å†…å®¹ï¼Œä¹Ÿå°±æ˜¯è¯´è°ƒç”¨`person1 `çš„`$ON`æ–¹æ³•ï¼š

```javascript
class Observer {
    constructor() {

    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on() {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

+ // å‘è¿™ä¸ª`person1`å§”æ‰˜ä¸€äº›å†…å®¹ï¼Œè°ƒç”¨`person1 `çš„`$ON`æ–¹æ³•
+ person1.$on()
å¤åˆ¶ä»£ç 
```

æ—¢ç„¶è¦å§”æ‰˜ä¸€äº›å†…å®¹ï¼Œé‚£ **äº‹ä»¶å** å°±å¿…ä¸å¯å°‘ï¼Œäº‹ä»¶è§¦å‘çš„æ—¶å€™ä¹Ÿéœ€è¦ä¸€ä¸ª **å›è°ƒå‡½æ•°**

- äº‹ä»¶å
- å›è°ƒå‡½æ•°

ä¸¾ä¸ªä¾‹å­ï¼Œæˆ‘ä»¬å†™å‡ ä¸ªäº‹ä»¶ï¼Œæ¯”å¦‚ï¼š

```javascript
class Observer {
    constructor() {

    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on() {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

// å‘è¿™ä¸ª`person1`å§”æ‰˜ä¸€äº›å†…å®¹ï¼Œè°ƒç”¨`person1 `çš„`$ON`æ–¹æ³•
person1.$on()

+ function handlerA() {
+     console.log('handlerA');
+ }
+ 
+ function handlerB() {
+     console.log('handlerB');
+ }
+ 
+ function handlerC() {
+     console.log('handlerC');
}
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬ç°åœ¨æ‹œæ‰˜ `person1` ç›‘å¬ä¸€ä¸‹ `ä¹°çº¢å®çŸ³` ï¼Œçº¢å®çŸ³åˆ°äº†ä¹‹åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•° `handlerA` å’Œ `handlerB`ï¼Œå°±å¯ä»¥è¿™æ ·å†™:

```javascript
class Observer {
    constructor() {

    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on() {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

// å‘è¿™ä¸ª`person1`å§”æ‰˜ä¸€äº›å†…å®¹ï¼Œè°ƒç”¨`person1 `çš„`$ON`æ–¹æ³•
+ person1.$on('ä¹°çº¢å®çŸ³', handlerA)
+ person1.$on('ä¹°çº¢å®çŸ³', handlerB)

function handlerA() {
    console.log('handlerA');
}

function handlerB() {
    console.log('handlerB');
}

function handlerC() {
    console.log('handlerC');
}
å¤åˆ¶ä»£ç 
```

å†æ‹œæ‰˜ `person1` ç›‘å¬ä¸€ä¸‹ `ä¹°å¥¶èŒ¶` ï¼Œå¥¶èŒ¶åˆ°äº†ä¹‹åï¼Œæ‰§è¡Œå›è°ƒå‡½æ•° `handlerC` :

```javascript
class Observer {
    constructor() {

    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on() {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

// å‘è¿™ä¸ª`person1`å§”æ‰˜ä¸€äº›å†…å®¹ï¼Œè°ƒç”¨`person1 `çš„`$ON`æ–¹æ³•
person1.$on('ä¹°çº¢å®çŸ³', handlerA)
person1.$on('ä¹°çº¢å®çŸ³', handlerB)

+ person1.$on('ä¹°å¥¶èŒ¶', handlerC)


function handlerA() {
    console.log('handlerA');
}

function handlerB() {
    console.log('handlerB');
}

function handlerC() {
    console.log('handlerC');
}
å¤åˆ¶ä»£ç 
```

## 3. è®¾ç½®ç¼“å­˜åˆ—è¡¨

åˆ°è¿™é‡Œæˆ‘ä»¬å°±éœ€è¦å‰é¢è®²åˆ°çš„ **ç¼“å­˜åˆ—è¡¨**ï¼ˆæ¶ˆæ¯é˜Ÿåˆ—ï¼‰ï¼Œä¹Ÿå°±æ˜¯*è°ƒåº¦ä¸­å¿ƒ*äº†ã€‚

ç»™`Observer`ç±»æ·»åŠ  ç¼“å­˜åˆ—è¡¨ï¼š

```javascript
class Observer {
    constructor() {
+       this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on() {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();
å¤åˆ¶ä»£ç 
```

è¿™ä¸ªç¼“å­˜åˆ—è¡¨ `message` å¯¹è±¡çš„åŠŸèƒ½å¦‚ä¸‹ï¼š

å‘ `person1` å§”æ‰˜ä¸€ä¸ª`buy`ç±»å‹çš„å†…å®¹ï¼Œå®Œæˆä¹‹åæ‰§è¡Œå›è°ƒå‡½æ•°  `handlerA` å’Œ `handlerB`

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on() {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

+ person1.$on('buy',handlerA);
+ person1.$on('buy',handlerB);

function handlerA() {
    console.log('handlerA');
}

function handlerB() {
    console.log('handlerB');
}

function handlerC() {
    console.log('handlerC');
}
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬å¸Œæœ›é€šè¿‡`$on`å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ ä¸Šé¢å†…å®¹åï¼Œå°±ç›¸å½“å¯¹ç»™`message`å¯¹è±¡æ·»åŠ äº†ä¸€ä¸ª`buy`å±æ€§ï¼Œè¿™ä¸ªå±æ€§å€¼ä¸º`[handlerA, handlerB]`ï¼Œç›¸å½“äºä¸‹é¢çš„æ•ˆæœï¼š

```javascript
class Observer {
    constructor() {
        this.message = {
+           buy: [handlerA, handlerB]
        }
    }
    // å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
    $on() {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}
å¤åˆ¶ä»£ç 
```

éœ€æ±‚æ˜ç¡®åï¼Œä¸‹é¢ç€æ‰‹ **å†™ `$on` å‡½æ•°** ğŸ‘‡ğŸ‘‡ğŸ‘‡

## 4. å®ç° $on æ–¹æ³•

å›é¡¾ä¸€è¡Œä»£ç ï¼š

```javascript
person1.$on('buy',handlerA);
å¤åˆ¶ä»£ç 
```

å¾ˆæ˜æ˜¾æˆ‘ä»¬ç»™`$on`æ–¹æ³•ä¼ å…¥äº†ä¸¤ä¸ªå‚æ•°ï¼š

- `type`ï¼šäº‹ä»¶å (äº‹ä»¶ç±»å‹)
- `callback`ï¼šå›è°ƒå‡½æ•°

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

+   /**
+    * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
+    * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
+    * @param {*} callback å›è°ƒå‡½æ•°
+    */
+   $on(type, callback) {}
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

person1.$on('buy', handlerA);
person1.$on('buy', handlerB);
å¤åˆ¶ä»£ç 
```

æˆ‘ä»¬åˆæ­¥è®¾æƒ³ä¸€ä¸‹å¦‚ä½•å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ï¼Œæ¶ˆæ¯é˜Ÿåˆ—æ˜¯ä¸€ä¸ªå¯¹è±¡ï¼Œå¯ä»¥é€šè¿‡ä¸‹é¢çš„æ–¹æ³•æ·»åŠ äº‹ä»¶å†…å®¹ï¼š

```js
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

    /**
     * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $on(type, callback) {
+       this.message[type] = callback;
    }
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}
å¤åˆ¶ä»£ç 
```

ä½†é€šè¿‡å‰æ–‡æˆ‘ä»¬çŸ¥é“æ¶ˆæ¯é˜Ÿåˆ—ä¸­æ¯ä¸ªå±æ€§å€¼éƒ½æ˜¯ **æ•°ç»„**ï¼š

```js
this.message = {
    buy: [handlerA, handlerB]
}
å¤åˆ¶ä»£ç 
```

å³æ¯ä¸ªäº‹ä»¶ç±»å‹å¯¹åº”å¤šä¸ªæ¶ˆæ¯ (å›è°ƒå‡½æ•°)ï¼Œè¿™æ ·çš„è¯æˆ‘ä»¬å°±è¦ä¸ºæ¯ä¸ªäº‹ä»¶ç±»å‹åˆ›å»ºä¸€ä¸ªæ•°ç»„ï¼Œå…·ä½“å†™æ³•ï¼š

1. å…ˆåˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ˆäº‹ä»¶ç±»å‹ï¼‰
2. å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
3. å¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¾€ä»–çš„åé¢pushä¸€ä¸ªæ–°çš„ callback

ä»£ç å®ç°å¦‚ä¸‹ï¼š

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

    /**
     * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $on(type, callback) {
+       // åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ˆäº‹ä»¶ç±»å‹ï¼‰
+       if (!this.message[type]) {
+           // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
+           this.message[type] = [];
+       }
+       // å¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¾€ä»–çš„åé¢pushä¸€ä¸ªæ–°çš„callback
+       this.message[type].push(callback)
    }
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}
å¤åˆ¶ä»£ç 
```

`$on` çš„ä»£ç å®ç°å¦‚ä¸Šæ‰€ç¤ºï¼Œæˆ‘ä»¬åŠ ä¸Šç”¨ä¾‹å¹¶å¼•å…¥åˆ°ä¸€ä¸ªhtmlæ–‡ä»¶ä¸­æµ‹è¯•ä¸€ä¸‹ï¼š

**Observe.js**

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

    /**
     * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $on(type, callback) {
        // åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ˆäº‹ä»¶ç±»å‹ï¼‰
        if (!this.message[type]) {
            // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
            this.message[type] = [];
        }
        // å¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¾€ä»–çš„åé¢pushä¸€ä¸ªæ–°çš„callback
        this.message[type].push(callback)
    }
    // åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
    $off() {}
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}

function handlerA() {
    console.log('handlerA');
}
function handlerB() {
    console.log('handlerB');
}
function handlerC() {
    console.log('handlerC');
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

person1.$on('buy', handlerA);
person1.$on('buy', handlerB);

console.log('person1 :>> ', person1);
å¤åˆ¶ä»£ç 
```

**Oberver.html**

```html
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>
</head>
<body>
    <!-- å¼•å…¥Observe.jsæ–‡ä»¶ -->
    <script src="../JS/Observer.js"></script>
</body>
</html>
å¤åˆ¶ä»£ç 
```

è¾“å‡ºç»“æœï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ea8a243ace3542e7958341c9c51a8674~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æ‰“å°å‡ºçš„ person1 æ˜¯ Oberver ç±»å‹çš„ï¼Œé‡Œé¢æœ‰ä¸€ä¸ªmessageï¼Œä¹Ÿå°±æ˜¯å’±å®šä¹‰çš„æ¶ˆæ¯é˜Ÿåˆ—ï¼›è¿™ä¸ªmessageé‡Œæœ‰æˆ‘ä»¬æ·»åŠ çš„`buy`ç±»å‹çš„äº‹ä»¶ï¼Œè¿™ä¸ª`buy`äº‹ä»¶æœ‰ä¸¤ä¸ªæ¶ˆæ¯ï¼š`[handlerAï¼ŒhandlerB]`ï¼Œæµ‹è¯•é€šè¿‡ ğŸ‘ğŸ‘ğŸ‘

æ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬æ¥å®ç° `$off` æ–¹æ³•

## 5. å®ç° $off æ–¹æ³•

`$off` æ–¹æ³•ç”¨æ¥åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹

`$off` æ–¹æ³•æœ‰ä¸¤ç§å†™æ³•ï¼š

1. `person1.$off("buy")` - åˆ é™¤æ•´ä¸ª`buy`äº‹ä»¶ç±»å‹
2. `person1.$off("buy",handlerA)` - åªåˆ é™¤`handlerA`æ¶ˆæ¯ï¼Œä¿ç•™`buy`äº‹ä»¶åˆ—è¡¨é‡Œçš„å…¶ä»–æ¶ˆæ¯

å’Œ`$on`æ–¹æ³•ä¸€æ ·ï¼Œ`$off`æ–¹æ³•ä¹Ÿéœ€è¦`type`å’Œ`callback`è¿™ä¸¤ä¸ªæ–¹æ³•ï¼š

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

    /**
     * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $on(type, callback) {
        // åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ˆäº‹ä»¶ç±»å‹ï¼‰
        if (!this.message[type]) {
            // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
            this.message[type] = [];
        }
        // å¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¾€ä»–çš„åé¢pushä¸€ä¸ªæ–°çš„callback
        this.message[type].push(callback)
    }

+   /**
+    * $off åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹
+    * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
+    * @param {*} callback å›è°ƒå‡½æ•°
+    */
+   $off(type, callback) {}
    
    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}
å¤åˆ¶ä»£ç 
```

`$off`æ–¹æ³•çš„å®ç°æ­¥éª¤å¦‚ä¸‹ï¼š

- åˆ¤æ–­æ˜¯å¦æœ‰è®¢é˜…ï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰typeè¿™ä¸ªç±»å‹çš„äº‹ä»¶ï¼Œæ²¡æœ‰çš„è¯å°±ç›´æ¥return
- åˆ¤æ–­æ˜¯å¦æœ‰fnè¿™ä¸ªå‚æ•°
  - æ²¡æœ‰fnå°±åˆ æ‰æ•´ä¸ªäº‹ä»¶
  - æœ‰fnå°±ä»…ä»…åˆ æ‰fnè¿™ä¸ªæ¶ˆæ¯

**ä»£ç å®ç°å¦‚ä¸‹ï¼š**

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

    /**
     * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $on(type, callback) {
        // åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ˆäº‹ä»¶ç±»å‹ï¼‰
        if (!this.message[type]) {
            // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
            this.message[type] = [];
        }
        // å¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¾€ä»–çš„åé¢pushä¸€ä¸ªæ–°çš„callback
        this.message[type].push(callback);
    }

    /**
     * $off åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $off(type, callback) {
+       // åˆ¤æ–­æ˜¯å¦æœ‰è®¢é˜…ï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰typeè¿™ä¸ªç±»å‹çš„äº‹ä»¶ï¼Œæ²¡æœ‰çš„è¯å°±ç›´æ¥return
+       if (!this.message[type]) return;
+       // åˆ¤æ–­æ˜¯å¦æœ‰callbackè¿™ä¸ªå‚æ•°
+       if (!callback) {
+           // å¦‚æœæ²¡æœ‰callback,å°±åˆ æ‰æ•´ä¸ªäº‹ä»¶ÃŸ
+           this.message[type] = undefined;
+       }
+       // å¦‚æœæœ‰callback,å°±ä»…ä»…åˆ æ‰callbackè¿™ä¸ªæ¶ˆæ¯(è¿‡æ»¤æ‰è¿™ä¸ªæ¶ˆæ¯æ–¹æ³•)
+       this.message[type] = this.message[type].filter((item) => item !== callback);
    }

    // è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`
    $emit() {}
}
å¤åˆ¶ä»£ç 
```

ä»¥ä¸Šå°±æ˜¯`$off`çš„å®ç°ï¼Œæˆ‘ä»¬å…ˆæ¥æµ‹è¯•ä¸€ä¸‹ï¼š

```javascript
class Observer {
	...
}

function handlerA() {
    console.log('handlerA');
}
function handlerB() {
    console.log('handlerB');
}
function handlerC() {
    console.log('handlerC');
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

person1.$on('buy', handlerA);
person1.$on('buy', handlerB);
person1.$on('buy', handlerC);

console.log('person1 :>> ', person1);
å¤åˆ¶ä»£ç 
```

è¾“å‡ºç»“æœï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/c38542ad48ff4566ad625e5651c14de5~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

**â— æµ‹è¯•åˆ é™¤å•ä¸ªæ¶ˆæ¯**ï¼Œä½¿ç”¨`$off` åˆ é™¤ handlerC æ¶ˆæ¯

```javascript
class Observer {
	...
}

function handlerA() {
    console.log('handlerA');
}
function handlerB() {
    console.log('handlerB');
}
function handlerC() {
    console.log('handlerC');
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

person1.$on('buy', handlerA);
person1.$on('buy', handlerB);
person1.$on('buy', handlerC);

console.log('person1 :>> ', person1);

+ // åˆ é™¤ handlerC æ¶ˆæ¯
+ person1.$off('buy',handlerC);

+ console.log('person1 :>> ', person1);
å¤åˆ¶ä»£ç 
```

è¾“å‡ºç»“æœï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/14e4b31fa28c4c3bba6ba8d72b0ee970~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æµ‹è¯•é€šè¿‡ ğŸ¥³ğŸ¥³ğŸ¥³

**â— æµ‹è¯•åˆ é™¤æ•´ä¸ªäº‹ä»¶ç±»å‹**ï¼Œä½¿ç”¨`$off` åˆ é™¤æ•´ä¸ª buy äº‹ä»¶

```javascript
class Observer {
	...
}

function handlerA() {
    console.log('handlerA');
}
function handlerB() {
    console.log('handlerB');
}
function handlerC() {
    console.log('handlerC');
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

person1.$on('buy', handlerA);
person1.$on('buy', handlerB);
person1.$on('buy', handlerC);

console.log('person1 :>> ', person1);

// åˆ é™¤ handlerC æ¶ˆæ¯
person1.$off('buy',handlerC);

console.log('person1 :>> ', person1);

+ // åˆ é™¤ buy äº‹ä»¶
+ person1.$off('buy');

+ console.log('person1 :>> ', person1);
å¤åˆ¶ä»£ç 
```

è¾“å‡ºç»“æœï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ef47aedbfbb54090a8153cf84b17a97e~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

Perfectï¼ï¼ï¼æµ‹è¯•é€šè¿‡ âœ…

è¿™æ ·ä»¥æ¥ `$off` çš„ä¸¤ä¸ªåŠŸèƒ½æˆ‘ä»¬å°±å·²ç»æˆåŠŸå®ç° ğŸ‘ğŸ‘ğŸ‘

â— å…³äº `$off` çš„å®ç°ï¼Œè¿™é‡Œè®²ä¸€ä¸ªå°ç»†èŠ‚ ğŸ‘‡

**javascript åˆ é™¤å¯¹è±¡çš„æŸä¸ªå±æ€§** æœ‰ä¸¤ç§æ–¹æ³•ï¼š

1. delete æ“ä½œç¬¦
2. `obj.key = undefined;`  (ç­‰åŒäº`obj[key] = undefined;`)

**è¿™ä¸¤ç§æ–¹æ³•çš„åŒºåˆ«ï¼š**

**1.** delete æ“ä½œç¬¦ä¼šä»æŸä¸ªå¯¹è±¡ä¸Šç§»é™¤æŒ‡å®šå±æ€§ï¼Œä½†å®ƒçš„å·¥ä½œé‡æ¯”å…¶â€œæ›¿ä»£â€è®¾ç½®ä¹Ÿå°±æ˜¯ `object[key] = undefined ` å¤šçš„å¤šçš„å¤šã€‚

å¹¶ä¸”è¯¥æ–¹æ³•æœ‰è¯¸å¤šé™åˆ¶ï¼Œæ¯”å¦‚ï¼Œä»¥ä¸‹æƒ…å†µéœ€è¦é‡ç‚¹è€ƒè™‘ï¼š

- å¦‚æœä½ è¯•å›¾åˆ é™¤çš„å±æ€§ä¸å­˜åœ¨ï¼Œé‚£ä¹ˆdeleteå°†ä¸ä¼šèµ·ä»»ä½•ä½œç”¨ï¼Œä½†ä»ä¼šè¿”å›true
- å¦‚æœå¯¹è±¡çš„åŸå‹é“¾ä¸Šæœ‰ä¸€ä¸ªä¸å¾…åˆ é™¤å±æ€§åŒåçš„å±æ€§ï¼Œé‚£ä¹ˆåˆ é™¤å±æ€§ä¹‹åï¼Œå¯¹è±¡ä¼šä½¿ç”¨åŸå‹é“¾ä¸Šçš„é‚£ä¸ªå±æ€§ï¼ˆä¹Ÿå°±æ˜¯è¯´ï¼Œdeleteæ“ä½œåªä¼šåœ¨è‡ªèº«çš„å±æ€§ä¸Šèµ·ä½œç”¨ï¼‰
- ä»»ä½•ä½¿ç”¨ `var` å£°æ˜çš„å±æ€§ä¸èƒ½ä»å…¨å±€ä½œç”¨åŸŸæˆ–å‡½æ•°çš„ä½œç”¨åŸŸä¸­åˆ é™¤ã€‚
  - è¿™æ ·çš„è¯ï¼Œdeleteæ“ä½œä¸èƒ½åˆ é™¤ä»»ä½•åœ¨å…¨å±€ä½œç”¨åŸŸä¸­çš„å‡½æ•°ï¼ˆæ— è®ºè¿™ä¸ªå‡½æ•°æ˜¯æ¥è‡ªäºå‡½æ•°å£°æ˜æˆ–å‡½æ•°è¡¨è¾¾å¼ï¼‰
  - é™¤äº†åœ¨å…¨å±€ä½œç”¨åŸŸä¸­çš„å‡½æ•°ä¸èƒ½è¢«åˆ é™¤ï¼Œåœ¨å¯¹è±¡(object)ä¸­çš„å‡½æ•°æ˜¯èƒ½å¤Ÿç”¨deleteæ“ä½œåˆ é™¤çš„ã€‚
- ä»»ä½•ç”¨`let`æˆ–`const` å£°æ˜çš„å±æ€§ä¸èƒ½å¤Ÿä»å®ƒè¢«å£°æ˜çš„ä½œç”¨åŸŸä¸­åˆ é™¤ã€‚
- ä¸å¯è®¾ç½®çš„(Non-configurable)å±æ€§ä¸èƒ½è¢«ç§»é™¤ã€‚è¿™æ„å‘³ç€åƒ`Math`, `Array`ï¼Œ `Object`å†…ç½®å¯¹è±¡çš„å±æ€§ä»¥åŠä½¿ç”¨`Object.defineProperty()`æ–¹æ³•è®¾ç½®ä¸ºä¸å¯è®¾ç½®çš„å±æ€§ä¸èƒ½è¢«åˆ é™¤ã€‚

**2.** `obj[key] = undefined;` è¿™ä¸ªé€‰æ‹©ä¸æ˜¯è¿™ä¸ªé—®é¢˜çš„æ­£ç¡®ç­”æ¡ˆï¼Œå› ä¸ºåªæ˜¯æŠŠæŸä¸ªå±æ€§æ›¿æ¢ä¸º`undefined`ï¼Œå±æ€§æœ¬èº«è¿˜åœ¨ã€‚ä½†æ˜¯ï¼Œå¦‚æœä½ å°å¿ƒä½¿ç”¨å®ƒï¼Œä½ å¯ä»¥å¤§å¤§åŠ å¿«ä¸€äº›ç®—æ³•ã€‚

**å¥½äº†ï¼Œå›åˆ°æ­£é¢˜** ğŸ™Œ

æ¥ä¸‹æ¥æˆ‘ä»¬å¼€å§‹å®ç°ç¬¬ä¸‰ä¸ªæ–¹æ³• `$emit` ğŸ§—â€â™€ï¸

## 6. å®ç° `$emit` æ–¹æ³•

`$emit` ç”¨æ¥è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ï¼š

- è¯¥æ–¹æ³•éœ€è¦ä¼ å…¥ä¸€ä¸ª `type` å‚æ•°ï¼Œç”¨æ¥ç¡®å®šè§¦å‘å“ªä¸€ä¸ªäº‹ä»¶ï¼›
- ä¸»è¦æµç¨‹å°±æ˜¯å¯¹è¿™ä¸ª`type`äº‹ä»¶åšä¸€ä¸ªè½®è¯¢ (forå¾ªç¯)ï¼ŒæŒ¨ä¸ªæ‰§è¡Œæ¯ä¸€ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°callbackå°±ğŸ‘Œäº†ã€‚

**å…·ä½“ä»£ç å®ç°å¦‚ä¸‹ï¼š**

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

    /**
     * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $on(type, callback) {
        // åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ˆäº‹ä»¶ç±»å‹ï¼‰
        if (!this.message[type]) {
            // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
            this.message[type] = [];
        }
        // å¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¾€ä»–çš„åé¢pushä¸€ä¸ªæ–°çš„callback
        this.message[type].push(callback);
    }

    /**
     * $off åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $off(type, callback) {
        // åˆ¤æ–­æ˜¯å¦æœ‰è®¢é˜…ï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰typeè¿™ä¸ªç±»å‹çš„äº‹ä»¶ï¼Œæ²¡æœ‰çš„è¯å°±ç›´æ¥return
        if (!this.message[type]) return;
        // åˆ¤æ–­æ˜¯å¦æœ‰callbackè¿™ä¸ªå‚æ•°
        if (!callback) {
            // å¦‚æœæ²¡æœ‰callback,å°±åˆ æ‰æ•´ä¸ªäº‹ä»¶
            this.message[type] = undefined;
            return;
        }
        // å¦‚æœæœ‰callback,å°±ä»…ä»…åˆ æ‰callbackè¿™ä¸ªæ¶ˆæ¯(è¿‡æ»¤æ‰è¿™ä¸ªæ¶ˆæ¯æ–¹æ³•)
        this.message[type] = this.message[type].filter((item) => item !== callback);
    }

+   /**
+    * $emit è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹
+    * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
+    */
+   $emit(type) {
+       // åˆ¤æ–­æ˜¯å¦æœ‰è®¢é˜…
+       if(!this.message[type]) return;
+       // å¦‚æœæœ‰è®¢é˜…ï¼Œå°±å¯¹è¿™ä¸ª`type`äº‹ä»¶åšä¸€ä¸ªè½®è¯¢ (forå¾ªç¯)
+       this.message[type].forEach(item => {
+           // æŒ¨ä¸ªæ‰§è¡Œæ¯ä¸€ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°callback
+           item()
+       });
+   }
}
å¤åˆ¶ä»£ç 
```

æ‰“å®Œæ”¶å·¥ğŸŒï¸â€â™€ï¸

æ¥æµ‹è¯•ä¸€ä¸‹å§ï½

```javascript
class Observer {
	...
}

function handlerA() {
    console.log('buy handlerA');
}
function handlerB() {
    console.log('buy handlerB');
}
function handlerC() {
    console.log('buy handlerC');
}

// ä½¿ç”¨æ„é€ å‡½æ•°åˆ›å»ºä¸€ä¸ªå®ä¾‹
const person1 = new Observer();

+ person1.$on('buy', handlerA);
+ person1.$on('buy', handlerB);
+ person1.$on('buy', handlerC);

console.log('person1 :>> ', person1);

+ // è§¦å‘ buy äº‹ä»¶
+ person1.$emit('buy')
å¤åˆ¶ä»£ç 
```

è¾“å‡ºç»“æœï¼š

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/aca849281156412fba52d356c6ba89d3~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

æµ‹è¯•é€šè¿‡ ğŸ‘ğŸ‘ğŸ‘

![åœ¨è¿™é‡Œæ’å…¥å›¾ç‰‡æè¿°](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/ee0afe5d24324530947a0d9f5f4f5045~tplv-k3u1fbpfcp-zoom-in-crop-mark:4536:0:0:0.awebp)

# å®Œæ•´ä»£ç 

æœ¬ç¯‡æ–‡ç« å®ç°äº†æœ€ç®€å•çš„å‘å¸ƒè®¢é˜…è€…æ¨¡å¼ï¼Œä»–çš„æ ¸å¿ƒå†…å®¹åªæœ‰å››ä¸ªï¼š

1. ç¼“å­˜åˆ—è¡¨ `message`
2. å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ `$on`
3. åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$off`
4. è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹ `$emit`

**å‘å¸ƒè®¢é˜…è€…æ¨¡å¼å®Œæ•´ä»£ç å®ç°ï¼š**

*å®Œæ•´ç‰ˆçš„ä»£ç è¾ƒé•¿ï¼Œè¿™é‡Œçœ‹ç€å¦‚æœä¸æ–¹ä¾¿çš„å¯ä»¥å»æˆ‘çš„GitHubä¸Šçœ‹ï¼Œæˆ‘ä¸“é—¨ç»´æŠ¤äº†ä¸€ä¸ª å‰ç«¯ BLOG çš„ä»“åº“*ï¼š[github.com/yuanyuanbytâ€¦](https://link.juejin.cn?target=https%3A%2F%2Fgithub.com%2Fyuanyuanbyte%2FBlog)

```javascript
class Observer {
    constructor() {
        this.message = {} // æ¶ˆæ¯é˜Ÿåˆ—
    }

    /**
     * `$on` å‘æ¶ˆæ¯é˜Ÿåˆ—æ·»åŠ å†…å®¹ 
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $on(type, callback) {
        // åˆ¤æ–­æœ‰æ²¡æœ‰è¿™ä¸ªå±æ€§ï¼ˆäº‹ä»¶ç±»å‹ï¼‰
        if (!this.message[type]) {
            // å¦‚æœæ²¡æœ‰è¿™ä¸ªå±æ€§ï¼Œå°±åˆå§‹åŒ–ä¸€ä¸ªç©ºçš„æ•°ç»„
            this.message[type] = [];
        }
        // å¦‚æœæœ‰è¿™ä¸ªå±æ€§ï¼Œå°±å¾€ä»–çš„åé¢pushä¸€ä¸ªæ–°çš„callback
        this.message[type].push(callback);
    }

    /**
     * $off åˆ é™¤æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     * @param {*} callback å›è°ƒå‡½æ•°
     */
    $off(type, callback) {
        // åˆ¤æ–­æ˜¯å¦æœ‰è®¢é˜…ï¼Œå³æ¶ˆæ¯é˜Ÿåˆ—é‡Œæ˜¯å¦æœ‰typeè¿™ä¸ªç±»å‹çš„äº‹ä»¶ï¼Œæ²¡æœ‰çš„è¯å°±ç›´æ¥return
        if (!this.message[type]) return;
        // åˆ¤æ–­æ˜¯å¦æœ‰callbackè¿™ä¸ªå‚æ•°
        if (!callback) {
            // å¦‚æœæ²¡æœ‰callback,å°±åˆ æ‰æ•´ä¸ªäº‹ä»¶
            this.message[type] = undefined;
            return;
        }
        // å¦‚æœæœ‰callback,å°±ä»…ä»…åˆ æ‰callbackè¿™ä¸ªæ¶ˆæ¯(è¿‡æ»¤æ‰è¿™ä¸ªæ¶ˆæ¯æ–¹æ³•)
        this.message[type] = this.message[type].filter((item) => item !== callback);
    }

    /**
     * $emit è§¦å‘æ¶ˆæ¯é˜Ÿåˆ—é‡Œçš„å†…å®¹
     * @param {*} type äº‹ä»¶å (äº‹ä»¶ç±»å‹)
     */
    $emit(type) {
        // åˆ¤æ–­æ˜¯å¦æœ‰è®¢é˜…
        if(!this.message[type]) return;
        // å¦‚æœæœ‰è®¢é˜…ï¼Œå°±å¯¹è¿™ä¸ª`type`äº‹ä»¶åšä¸€ä¸ªè½®è¯¢ (forå¾ªç¯)
        this.message[type].forEach(item => {
            // æŒ¨ä¸ªæ‰§è¡Œæ¯ä¸€ä¸ªæ¶ˆæ¯çš„å›è°ƒå‡½æ•°callback
            item()
        });
    }
    
    //ä¸ºäº‹ä»¶æ³¨å†Œå•æ¬¡ç›‘å¬å™¨,å¹¶ä¸éœ€è¦æ‰§è¡Œï¼Œåªéœ€è¦åœ¨æ‰§è¡Œåå°†wrapFancè¿™ä¸ªå›è°ƒä½¿ç”¨offåˆ é™¤å°±å¥½
    $once(type, callback,...args) {
        let wrapFanc = () => {
            callback.apply(this,...args)
            this.off(event,wrapFanc)
        }
        this.on(event,wrapFanc)
  	}
   
    //æ¸…é™¤è¿™ä¸ªäº‹ä»¶ç±»å‹çš„å›è°ƒ
    clear(type) {
    	if (this.message[type]) this.message[type] = []
  	}
}
```

